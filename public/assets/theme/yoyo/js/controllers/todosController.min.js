define(["handlebars","handlebarsHelpers"],function(o,t){var e=function(){var t={init:function(){this.cacheDom(),this.ajaxLoadForm(),this.onFormSubmit()},cacheDom:function(){this.$txtTodoTitle=$("#txtTodoTitle"),this.$txtTodoText=$("#txtTodoText"),this.$todo=$("#todos"),this.$notes=$("#notes"),this.$form=$("#form-todo"),this.$formBtn=$("#todo-form #btnSubmit"),this.$modal=$("#yoyoModal"),this.$formModal=$("#formTodoModal"),this.$formTodoModal=$("#form-todo-modal"),this.$todoTimeline=$("#todo-timeline"),this.$notesTimeline=$("#notes-timeline")},loadModalMessage:function(o){this.$modal.find(".modal-body span").text(o),this.$modal.modal("show"),this.ajaxLoadForm(),setTimeout(function(){t.$modal.modal("hide")},2e3)},ajaxLoadForm:function(){$.ajax({url:this.$todo.data("ajax-url"),dataType:"json",type:"get",beforeSend:function(){t.$todoTimeline.html('<p class="text-center">Loading content...</p>')}}).done(function(e){var a=$("#todo-template"),n=a.html(),a=o.compile(n);"undefined"!=typeof e.results&&(t.$todoTimeline.html(a(e)),t.onConversion(),t.onDelete(),t.todoAction(),t.onUpdate())})},ajaxLoadNotesForm:function(){$.ajax({url:this.$notes.data("ajax-url"),dataType:"json",type:"get",beforeSend:function(){t.$notesTimeline.html('<p class="text-center">Loading content...</p>')}}).done(function(e){var a=$("#notes-template"),n=a.html(),a=o.compile(n);"undefined"!=typeof e.results&&t.$notesTimeline.html(a(e))})},ajaxSubmitForm:function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({url:this.$form.attr("action"),type:"post",data:this.$form.serialize(),dataType:"json"}).done(function(e){var a=$("#todo-template"),n=a.html(),a=o.compile(n);"undefined"!=typeof e.transaction&&e.transaction&&(t.$txtTodoTitle.val(""),t.$txtTodoText.val(""),t.$modal.find(".modal-body span").text(e.message),t.$modal.modal("show"),t.ajaxLoadForm(),setTimeout(function(){t.$modal.modal("hide")},2e3))}).error(function(){alert("Error")})},ajaxConversion:function(o){$.ajax({url:o.attr("href"),dataType:"json",type:"get",beforeSend:function(){t.$todoTimeline.html('<p class="text-center">Processing conversion...</p>')}}).done(function(o){"undefined"!=typeof o.transaction&&o.transaction&&(t.$modal.find(".modal-body span").text(o.message),t.$modal.modal("show"),t.ajaxLoadForm(),t.ajaxLoadNotesForm(),setTimeout(function(){t.$modal.modal("hide")},2e3))}).error(function(){alert("Error")})},ajaxDelete:function(o){$.ajax({url:o.attr("href"),dataType:"json",type:"get",beforeSend:function(){t.$todoTimeline.html('<p class="text-center">Deleting item...</p>')}}).done(function(o){"undefined"!=typeof o.transaction&&o.transaction&&(t.$modal.find(".modal-body span").text(o.message),t.$modal.modal("show"),t.ajaxLoadForm(),t.ajaxLoadNotesForm(),setTimeout(function(){t.$modal.modal("hide")},2e3))}).error(function(){alert("Error")})},ajaxUpdate:function(){$.ajax({url:this.$formTodoModal.attr("action"),dataType:"json",type:"post",data:this.$formTodoModal.serialize()}).done(function(o){"undefined"!=typeof o.transaction&&o.transaction&&t.loadModalMessage(o.message)}).always(function(){t.$formModal.modal("hide")}).error(function(){alert("Error")})},onConversion:function(){$(document).on("click","a.todo-to-note",function(o){o.stopImmediatePropagation(),o.preventDefault(),t.ajaxConversion($(this))})},onDelete:function(){$(document).on("click","a.delete-todo",function(o){o.stopImmediatePropagation(),o.preventDefault(),t.ajaxDelete($(this))})},onUpdate:function(){var o=this.$formTodoModal.attr("action");$(document).on("click","a.todo-title",function(e){var a=$(this),n=a.closest(".todo-container"),i=o+"/"+n.find(".hfTodoId").val();e.stopImmediatePropagation(),e.preventDefault(),t.$formTodoModal.attr("action",i),t.$formTodoModal.find("#txtTodoTitle").val(a.text()),t.$formTodoModal.find("#txtTodoText").val(n.find(".todo-text").text()),t.$formModal.modal("show")}),this.$formTodoModal.submit(function(o){o.preventDefault(),t.ajaxUpdate()})},ajaxTodo:function(o,t,e,a){$.ajax({url:this.$todoTimeline.data("ajax-url"),dataType:"json",type:"post",data:{todo_id:t,is_done:e}}).done(function(t){if("undefined"!=typeof t.transaction){var a=o.closest(".todo-container"),n=a.find(".todo-title"),i=a.find("p");e?(a.addClass("bg-success"),n.wrap("<strike></strike>"),i.wrap("<strike></strike>")):(a.removeClass("bg-success"),n.unwrap(),i.unwrap())}}).error(function(){alert("Error;")})},todoAction:function(){var o;$(document).on("click",".cbx-is-done",function(){o=$(this),t.ajaxTodo(o,o.val(),o.prop("checked"),t.$todoTimeline)})},onFormSubmit:function(){this.$form.submit(function(o){o.preventDefault(),t.ajaxSubmitForm()})}};t.init()};return e});