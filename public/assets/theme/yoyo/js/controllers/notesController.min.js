define(["handlebars","handlebarsHelpers"],function(t,o){var e=function(){var o={init:function(){this.cacheDom(),this.ajaxLoadForm(),this.onFormSubmit()},cacheDom:function(){this.$txtNoteTitle=$("#txtNoteTitle"),this.$txtNoteText=$("#txtNoteText"),this.$todo=$("#todos"),this.$notes=$("#notes"),this.$form=$("#form-notes"),this.$formBtn=$("#notes-form #btnSubmit"),this.$modal=$("#yoyoModal"),this.$formModal=$("#formNotesModal"),this.$formNotesModal=$("#form-notes-modal"),this.$notesTimeline=$("#notes-timeline"),this.$todoTimeline=$("#todo-timeline")},loadModalMessage:function(t){this.$modal.find(".modal-body span").text(t),this.$modal.modal("show"),this.ajaxLoadForm(),setTimeout(function(){o.$modal.modal("hide")},2e3)},ajaxLoadForm:function(){$.ajax({url:this.$notes.data("ajax-url"),dataType:"json",type:"get",beforeSend:function(){o.$notesTimeline.html('<p class="text-center">Loading content...</p>')}}).done(function(e){var n=$("#notes-template"),a=n.html(),n=t.compile(a);"undefined"!=typeof e.results&&(o.$notesTimeline.html(n(e)),o.onConversion(),o.onDelete(),o.onUpdate())})},ajaxLoadTodoForm:function(){$.ajax({url:this.$todo.data("ajax-url"),dataType:"json",type:"get",beforeSend:function(){o.$todoTimeline.html('<p class="text-center">Loading content...</p>')}}).done(function(e){var n=$("#todo-template"),a=n.html(),n=t.compile(a);"undefined"!=typeof e.results&&o.$todoTimeline.html(n(e))})},ajaxSubmitForm:function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({url:this.$form.attr("action"),type:"post",data:this.$form.serialize(),dataType:"json"}).done(function(e){var n=$("#notes-template"),a=n.html(),n=t.compile(a);"undefined"!=typeof e.transaction&&e.transaction&&(o.$txtNoteTitle.val(""),o.$txtNoteText.val(""),o.loadModalMessage(e.message))}).error(function(){alert("Error")})},ajaxConversion:function(t){$.ajax({url:t.attr("href"),dataType:"json",type:"get",beforeSend:function(){o.$notesTimeline.html('<p class="text-center">Processing conversion...</p>')}}).done(function(t){"undefined"!=typeof t.transaction&&t.transaction&&(o.ajaxLoadTodoForm(),o.loadModalMessage(t.message))}).error(function(){alert("Error")})},ajaxDelete:function(t){$.ajax({url:t.attr("href"),dataType:"json",type:"get",beforeSend:function(){o.$notesTimeline.html('<p class="text-center">Deleting item...</p>')}}).done(function(t){"undefined"!=typeof t.transaction&&t.transaction&&(o.ajaxLoadTodoForm(),o.loadModalMessage(t.message))}).error(function(){alert("Error")})},ajaxUpdate:function(){$.ajax({url:this.$formNotesModal.attr("action"),dataType:"json",type:"post",data:this.$formNotesModal.serialize()}).done(function(t){"undefined"!=typeof t.transaction&&t.transaction&&o.loadModalMessage(t.message)}).always(function(){o.$formModal.modal("hide")}).error(function(){alert("Error")})},onConversion:function(){$(document).on("click","a.note-to-todo",function(t){t.stopImmediatePropagation(),t.preventDefault(),o.ajaxConversion($(this))})},onDelete:function(){$(document).on("click","a.delete-note",function(t){t.stopImmediatePropagation(),t.preventDefault(),o.ajaxDelete($(this))})},onUpdate:function(){var t=this.$formNotesModal.attr("action");$(document).on("click","a.note-title",function(e){var n=$(this),a=n.parents(".timeline-content"),i=t+"/"+a.find(".hfNoteId").val();e.stopImmediatePropagation(),e.preventDefault(),o.$formNotesModal.attr("action",i),o.$formNotesModal.find("#txtNoteTitle").val(n.text()),o.$formNotesModal.find("#txtNoteText").val(a.find(".note-text").text()),o.$formModal.modal("show")}),this.$formNotesModal.submit(function(t){t.preventDefault(),o.ajaxUpdate()})},onFormSubmit:function(){this.$form.submit(function(t){t.preventDefault(),o.ajaxSubmitForm()})}};o.init()};return e});